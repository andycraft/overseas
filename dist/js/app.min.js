function isMobile(){let e=document.querySelector(".menu-bar__desktop-menu");return"none"==window.getComputedStyle(e).getPropertyValue("display")}function addEventHandler(e,t,s){document.querySelectorAll(e).forEach(e=>{e.addEventListener(t,s)})}function toggleMobileMenu(e){e.preventDefault(),document.querySelector(".mobile-menu").classList.toggle("is-active")}function toggleDropDownMenu(e){e.preventDefault();let t=this.parentElement,s=t.classList.contains("menu-bar__user"),i=t.classList.contains("is-active");s&&isMobile()?(t.classList.remove("is-active"),toggleMobileMenu(e)):i?t.classList.remove("is-active"):(document.querySelector(".menu-bar__user").classList.remove("is-active"),document.querySelector(".menu-bar__language").classList.remove("is-active"),document.querySelector(".menu-bar__currency").classList.remove("is-active"),t.classList.add("is-active"))}function toggleSubMenu(e){e.preventDefault(),this.parentElement.classList.toggle("is-active")}function showAllCountries(e){e.preventDefault();document.querySelectorAll(".main-search__countries__country-list .is-hidden").forEach(e=>{e.classList.remove("is-hidden")}),document.querySelector(".main-search__countries__show-all").remove()}console.log("dom ready"),addEventHandler(".mobile-menu-burger__button","click",toggleMobileMenu),addEventHandler(".mobile-menu__list__item.has-submenu > a","click",toggleSubMenu),addEventHandler(".menu-bar__user__button, .menu-bar__currency__button, .menu-bar__language__button","click",toggleDropDownMenu),addEventHandler(".main-search__countries__show-all__button","click",showAllCountries),addEventHandler(".add-listing__dropdown-input__button","click",(function(e){e.preventDefault(),this.parentElement.classList.toggle("is-active");let t=this.parentElement.querySelector(".options");t&&t.classList.toggle("is-hidden")})),addEventHandler(".add-listing__tag","click",(function(e){e.preventDefault(),this.classList.toggle("is-selected")})),addEventHandler(".property-details__description__title__see-more","click",(function(e){e.preventDefault(),this.parentElement.classList.toggle("is-active"),document.querySelector(".property-details__description__text").classList.toggle("is-hidden")})),addEventHandler(".inline-form__input__dropdown","click",(function(e){e.preventDefault(),this.classList.toggle("is-active")})),addEventHandler(".btn--toggle-errors","click",(function(e){e.preventDefault(),document.querySelectorAll(".add-listing__field").forEach(e=>{e.classList.toggle("has-errors")})})),addEventHandler(".property-details__data__item__button--save","click",(function(e){e.preventDefault(),this.classList.toggle("is-active")})),addEventHandler(".property-gm__switch--to-map","click",(function(e){e.preventDefault(),this.classList.add("is-hidden"),document.querySelector(".property-gallery").classList.add("is-hidden"),document.querySelector(".property-gm__switch--to-gallery").classList.remove("is-hidden"),document.querySelector(".property-map").classList.remove("is-hidden")})),addEventHandler(".property-gm__switch--to-gallery","click",(function(e){e.preventDefault(),this.classList.add("is-hidden"),document.querySelector(".property-map").classList.add("is-hidden"),document.querySelector(".property-gm__switch--to-map").classList.remove("is-hidden"),document.querySelector(".property-gallery").classList.remove("is-hidden")})),addEventHandler(".property-map__zoom","click",(function(e){e.preventDefault(),this.classList.toggle("is-active"),document.querySelector(".property-map__map").classList.toggle("is-zoomed")})),addEventHandler(".similar-properties__item__photo__save","click",(function(e){e.preventDefault(),this.classList.toggle("is-active")})),document.querySelectorAll(".country-list__item").forEach(e=>{let t=e.querySelector(".country-list__item-country");t&&(e.title=t.innerText)}),addEventHandler(".agency-description__title__see-more","click",(function(e){e.preventDefault(),this.parentElement.classList.toggle("is-active"),document.querySelector(".agency-description__text").classList.toggle("is-hidden")})),addEventHandler(".agency-specialists__title__see-more","click",(function(e){e.preventDefault(),this.parentElement.classList.toggle("is-active"),document.querySelector(".agency-specialists__list").classList.toggle("is-hidden")})),addEventHandler(".property-list__item-photo-remove, .property-list__item-details-buttons-remove, .property-list__item-info-buttons-remove","click",(function(e){e.preventDefault();let t=this.closest(".property-list__item");t&&t.classList.toggle("is-hidden")})),addEventHandler(".property-list__item-photo-like, .property-list__item-details-buttons-like, .property-list__item-info-buttons-like","click",(function(e){e.preventDefault();let t=this.closest(".property-list__item");t&&t.classList.toggle("is-liked")})),addEventHandler(".search-form__flats-button, .search-form__bedrooms-button, .search-form__cost-button","click",(function(e){e.preventDefault(),this.classList.toggle("is-active");let t=this.parentElement;t.classList.toggle("is-active");let s=t.querySelector(".options");s&&s.classList.toggle("is-hidden")})),addEventHandler(".search-form__filters-button","click",(function(e){e.preventDefault(),this.classList.toggle("is-active");let t=document.querySelector(".search-form__popup");t&&t.classList.toggle("is-hidden")})),addEventHandler(".search-form__popup-input-button","click",(function(e){e.preventDefault(),this.classList.toggle("is-active");let t=this.parentElement;t.classList.toggle("is-active");let s=t.querySelector(".options");s&&s.classList.toggle("is-hidden")})),addEventHandler(".search-form__popup-tag","click",(function(e){e.preventDefault(),this.classList.toggle("is-selected")})),addEventHandler(".search-form__popup-title-switch","click",(function(e){e.preventDefault();let t=this.closest(".search-form__popup-group");t&&t.classList.toggle("is-active")})),addEventHandler(".search-result__tag-remove","click",(function(e){e.preventDefault();let t=this.closest(".search-result__tag");t&&t.remove()})),addEventHandler(".search-result__controls-item-button","click",(function(e){e.preventDefault(),this.classList.toggle("is-active")})),addEventHandler(".content__body--common .tabs__item","click",(function(e){e.preventDefault(),this.closest(".tabs").querySelectorAll(".tabs__item").forEach(e=>{e.classList.remove("is-selected")}),this.classList.add("is-selected")})),addEventHandler(".content__body--common .faq__item-link","click",(function(e){e.preventDefault();let t=this.closest(".faq__item");t&&t.classList.toggle("is-active")})),addEventHandler(".options__item","click",(function(e){let t=this.closest(".options");if(t)if(t.classList.contains("options--multiple")){let e=this.querySelector(".cbx");e?e.checked?this.classList.add("is-selected"):this.classList.remove("is-selected"):this.classList.toggle("is-selected")}else{t.querySelectorAll(".options__item").forEach(e=>{e.classList.remove("is-selected")}),t.querySelectorAll(".cbx").forEach(e=>{e.checked=""}),this.classList.add("is-selected");let e=this.querySelector(".cbx");e&&(e.checked="checked");let s=t.parentElement;s.classList.remove("is-active");let i=s.querySelector("button");i&&i.classList.remove("is-active"),t.classList.add("is-hidden");let l=s.querySelector("input[type=text]");l&&(l.value=this.innerText.trim())}}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJpc01vYmlsZSIsImRlc2t0b3BNZW51IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwid2luZG93IiwiZ2V0Q29tcHV0ZWRTdHlsZSIsImdldFByb3BlcnR5VmFsdWUiLCJhZGRFdmVudEhhbmRsZXIiLCJzZWxlY3RvciIsImV2ZW50IiwiaGFuZGxlciIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZWwiLCJhZGRFdmVudExpc3RlbmVyIiwidG9nZ2xlTW9iaWxlTWVudSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImNsYXNzTGlzdCIsInRvZ2dsZSIsInRvZ2dsZURyb3BEb3duTWVudSIsInBhcmVudCIsInRoaXMiLCJwYXJlbnRFbGVtZW50IiwiaXNVc2VyTWVudSIsImNvbnRhaW5zIiwiaXNBY3RpdmUiLCJyZW1vdmUiLCJhZGQiLCJ0b2dnbGVTdWJNZW51Iiwic2hvd0FsbENvdW50cmllcyIsImNvdW50cnkiLCJjb25zb2xlIiwibG9nIiwib3B0aW9ucyIsImZpZWxkIiwidGl0bGUiLCJpbm5lclRleHQiLCJwcm9wZXJ0eSIsImNsb3Nlc3QiLCJwb3B1cCIsImdyb3VwIiwidGFnIiwidGFiIiwiZmFxX2l0ZW0iLCJjaGVja2JveCIsImNoZWNrZWQiLCJjYngiLCJidXR0b24iLCJpbnB1dCIsInZhbHVlIiwidHJpbSJdLCJtYXBwaW5ncyI6IkFBQUEsU0FBU0EsV0FFTCxJQUFJQyxFQUFjQyxTQUFTQyxjQUFjLDJCQUV6QyxNQUFrQixRQURMQyxPQUFPQyxpQkFBaUJKLEdBQWFLLGlCQUFpQixXQUl2RSxTQUFTQyxnQkFBZ0JDLEVBQVVDLEVBQU9DLEdBRXRDUixTQUFTUyxpQkFBaUJILEdBQVVJLFFBQVFDLElBQ3hDQSxFQUFHQyxpQkFBaUJMLEVBQU9DLEtBSW5DLFNBQVNLLGlCQUFpQkMsR0FFdEJBLEVBQUVDLGlCQUNGZixTQUFTQyxjQUFjLGdCQUFnQmUsVUFBVUMsT0FBTyxhQUc1RCxTQUFTQyxtQkFB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VVMsT0FBTyxlQUcxQkwsS0FBS0osVUFBVUMsT0FBTyxtQkFFdkIsQ0FDaUJlLEVBQVF2QixpQkFBaUIsa0JBQy9CQyxRQUFTK0IsSUFDbkJBLEVBQUl6QixVQUFVUyxPQUFPLGlCQUdBTyxFQUFRdkIsaUJBQWlCLFFBQy9CQyxRQUFTbUMsSUFDeEJBLEVBQUlELFFBQVUsS0FHbEJ4QixLQUFLSixVQUFVVSxJQUFJLGVBRW5CLElBQUlpQixFQUFXdkIsS0FBS25CLGNBQWMsUUFDOUIwQyxJQUFVQSxFQUFTQyxRQUFVLFdBRWpDLElBQUl6QixFQUFTYSxFQUFRWCxjQUNyQkYsRUFBT0gsVUFBVVMsT0FBTyxhQUV4QixJQUFJcUIsRUFBUzNCLEVBQU9sQixjQUFjLFVBQzlCNkMsR0FDQUEsRUFBTzlCLFVBQVVTLE9BQU8sYUFHNUJPLEVBQVFoQixVQUFVVSxJQUFJLGFBR3RCLElBQUlxQixFQUFRNUIsRUFBT2xCLGNBQWMsb0JBQzdCOEMsSUFDQUEsRUFBTUMsTUFBUTVCLEtBQUtlLFVBQVVjIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBpc01vYmlsZSgpXG57XG4gICAgbGV0IGRlc2t0b3BNZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1lbnUtYmFyX19kZXNrdG9wLW1lbnUnKTtcbiAgICBsZXQgc3RhdHVzID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZGVza3RvcE1lbnUpLmdldFByb3BlcnR5VmFsdWUoJ2Rpc3BsYXknKTtcbiAgICByZXR1cm4gKHN0YXR1cyA9PSAnbm9uZScpID8gdHJ1ZSA6IGZhbHNlO1xufVxuXG5mdW5jdGlvbiBhZGRFdmVudEhhbmRsZXIoc2VsZWN0b3IsIGV2ZW50LCBoYW5kbGVyKVxue1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpLmZvckVhY2goZWwgPT4ge1xuICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBoYW5kbGVyKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gdG9nZ2xlTW9iaWxlTWVudShlKVxue1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9iaWxlLW1lbnUnKS5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcbn1cblxuZnVuY3Rpb24gdG9nZ2xlRHJvcERvd25NZW51KGUpXG57XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgbGV0IHBhcmVudCA9IHRoaXMucGFyZW50RWxlbWVudDtcbiAgICBsZXQgaXNVc2VyTWVudSA9IHBhcmVudC5jbGFzc0xpc3QuY29udGFpbnMoJ21lbnUtYmFyX191c2VyJyk7XG4gICAgbGV0IGlzQWN0aXZlID0gcGFyZW50LmNsYXNzTGlzdC5jb250YWlucygnaXMtYWN0aXZlJyk7XG5cbiAgICBpZiAoaXNVc2VyTWVudSAmJiBpc01vYmlsZSgpKSB7XG4gICAgICAgIHBhcmVudC5jbGFzc0xpc3QucmVtb3ZlKCdpcy1hY3RpdmUnKTtcbiAgICAgICAgdG9nZ2xlTW9iaWxlTWVudShlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaXNBY3RpdmUpIHtcbiAgICAgICAgICAgIHBhcmVudC5jbGFzc0xpc3QucmVtb3ZlKCdpcy1hY3RpdmUnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGZpcnN0IHJlbW92ZSB0aGUgYWN0aXZlIGNsYXNzIGZyb20gYWxsIGRyb3AtZG93biBtZW51c1xuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1lbnUtYmFyX191c2VyJykuY2xhc3NMaXN0LnJlbW92ZSgnaXMtYWN0aXZlJyk7XG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWVudS1iYXJfX2xhbmd1YWdlJykuY2xhc3NMaXN0LnJlbW92ZSgnaXMtYWN0aXZlJyk7XG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWVudS1iYXJfX2N1cnJlbmN5JykuY2xhc3NMaXN0LnJlbW92ZSgnaXMtYWN0aXZlJyk7XG5cbiAgICAgICAgICAgIC8vIGFkZCB0aGUgYWN0aXZlIGNsYXNzIHRvIHNlbGVjdGVkIGRyb3AtZG93biBtZW51XG4gICAgICAgICAgICBwYXJlbnQuY2xhc3NMaXN0LmFkZCgnaXMtYWN0aXZlJyk7XG4gICAgICAgIH1cblxuICAgIH1cblxufVxuXG5mdW5jdGlvbiB0b2dnbGVTdWJNZW51KGUpXG57XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMucGFyZW50RWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcbn1cblxuZnVuY3Rpb24gc2hvd0FsbENvdW50cmllcyhlKVxue1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIGNvbnN0IGhpZGRlbkNvdW50cmllcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tYWluLXNlYXJjaF9fY291bnRyaWVzX19jb3VudHJ5LWxpc3QgLmlzLWhpZGRlbicpO1xuXG4gICAgaGlkZGVuQ291bnRyaWVzLmZvckVhY2goKGNvdW50cnkpID0+IHtcbiAgICAgICAgY291bnRyeS5jbGFzc0xpc3QucmVtb3ZlKCdpcy1oaWRkZW4nKTtcbiAgICB9KTtcblxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tYWluLXNlYXJjaF9fY291bnRyaWVzX19zaG93LWFsbCcpLnJlbW92ZSgpO1xufVxuXG4oZnVuY3Rpb24oKXtcbiAgICBjb25zb2xlLmxvZygnZG9tIHJlYWR5Jyk7XG5cbiAgICAvLyBBbGwgcGFnZXNcblxuICAgIGFkZEV2ZW50SGFuZGxlcignLm1vYmlsZS1tZW51LWJ1cmdlcl9fYnV0dG9uJywgJ2NsaWNrJywgdG9nZ2xlTW9iaWxlTWVudSk7XG4gICAgYWRkRXZlbnRIYW5kbGVyKCcubW9iaWxlLW1lbnVfX2xpc3RfX2l0ZW0uaGFzLXN1Ym1lbnUgPiBhJywgJ2NsaWNrJywgdG9nZ2xlU3ViTWVudSk7XG5cbiAgICBhZGRFdmVudEhhbmRsZXIoXG4gICAgICAgICcubWVudS1iYXJfX3VzZXJfX2J1dHRvbiwgLm1lbnUtYmFyX19jdXJyZW5jeV9fYnV0dG9uLCAubWVudS1iYXJfX2xhbmd1YWdlX19idXR0b24nLFxuICAgICAgICAnY2xpY2snLFxuICAgICAgICB0b2dnbGVEcm9wRG93bk1lbnVcbiAgICApO1xuXG4gICAgLy8gTWFpbiBwYWdlXG5cbiAgICBhZGRFdmVudEhhbmRsZXIoJy5tYWluLXNlYXJjaF9fY291bnRyaWVzX19zaG93LWFsbF9fYnV0dG9uJywgJ2NsaWNrJywgc2hvd0FsbENvdW50cmllcyk7XG5cbiAgICAvLyBBZGQgbGlzdGluZyBwYWdlXG5cbiAgICBhZGRFdmVudEhhbmRsZXIoJy5hZGQtbGlzdGluZ19fZHJvcGRvd24taW5wdXRfX2J1dHRvbicsICdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMucGFyZW50RWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcblxuICAgICAgICBsZXQgb3B0aW9ucyA9IHRoaXMucGFyZW50RWxlbWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9ucycpO1xuICAgICAgICBpZiAob3B0aW9ucykge1xuICAgICAgICAgICAgb3B0aW9ucy5jbGFzc0xpc3QudG9nZ2xlKCdpcy1oaWRkZW4nKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgYWRkRXZlbnRIYW5kbGVyKCcuYWRkLWxpc3RpbmdfX3RhZycsICdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtc2VsZWN0ZWQnKTtcbiAgICB9KTtcblxuICAgIGFkZEV2ZW50SGFuZGxlcignLnByb3BlcnR5LWRldGFpbHNfX2Rlc2NyaXB0aW9uX190aXRsZV9fc2VlLW1vcmUnLCAnY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9wZXJ0eS1kZXRhaWxzX19kZXNjcmlwdGlvbl9fdGV4dCcpLmNsYXNzTGlzdC50b2dnbGUoJ2lzLWhpZGRlbicpO1xuICAgIH0pO1xuXG4gICAgYWRkRXZlbnRIYW5kbGVyKCcuaW5saW5lLWZvcm1fX2lucHV0X19kcm9wZG93bicsICdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XG4gICAgfSk7XG5cbiAgICBhZGRFdmVudEhhbmRsZXIoJy5idG4tLXRvZ2dsZS1lcnJvcnMnLCAnY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYWRkLWxpc3RpbmdfX2ZpZWxkJykuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgICAgICAgIGZpZWxkLmNsYXNzTGlzdC50b2dnbGUoJ2hhcy1lcnJvcnMnKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBQcm9wZXJ0eSBwYWdlXG5cbiAgICBhZGRFdmVudEhhbmRsZXIoJy5wcm9wZXJ0eS1kZXRhaWxzX19kYXRhX19pdGVtX19idXR0b24tLXNhdmUnLCAnY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLmNsYXNzTGlzdC50b2dnbGUoJ2lzLWFjdGl2ZScpO1xuICAgIH0pO1xuXG4gICAgYWRkRXZlbnRIYW5kbGVyKCcucHJvcGVydHktZ21fX3N3aXRjaC0tdG8tbWFwJywgJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKCdpcy1oaWRkZW4nKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb3BlcnR5LWdhbGxlcnknKS5jbGFzc0xpc3QuYWRkKCdpcy1oaWRkZW4nKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb3BlcnR5LWdtX19zd2l0Y2gtLXRvLWdhbGxlcnknKS5jbGFzc0xpc3QucmVtb3ZlKCdpcy1oaWRkZW4nKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb3BlcnR5LW1hcCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWhpZGRlbicpO1xuICAgIH0pO1xuXG4gICAgYWRkRXZlbnRIYW5kbGVyKCcucHJvcGVydHktZ21fX3N3aXRjaC0tdG8tZ2FsbGVyeScsICdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZCgnaXMtaGlkZGVuJyk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9wZXJ0eS1tYXAnKS5jbGFzc0xpc3QuYWRkKCdpcy1oaWRkZW4nKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb3BlcnR5LWdtX19zd2l0Y2gtLXRvLW1hcCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWhpZGRlbicpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvcGVydHktZ2FsbGVyeScpLmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWhpZGRlbicpO1xuICAgIH0pO1xuXG4gICAgYWRkRXZlbnRIYW5kbGVyKCcucHJvcGVydHktbWFwX196b29tJywgJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb3BlcnR5LW1hcF9fbWFwJykuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtem9vbWVkJyk7XG4gICAgfSk7XG5cbiAgICBhZGRFdmVudEhhbmRsZXIoJy5zaW1pbGFyLXByb3BlcnRpZXNfX2l0ZW1fX3Bob3RvX19zYXZlJywgJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcbiAgICB9KTtcblxuICAgIC8vIEFnZW5jeSBwYWdlXG5cbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY291bnRyeS1saXN0X19pdGVtJykuZm9yRWFjaChlbCA9PiB7XG4gICAgICAgIGxldCBjb3VudHJ5ID0gZWwucXVlcnlTZWxlY3RvcignLmNvdW50cnktbGlzdF9faXRlbS1jb3VudHJ5Jyk7XG4gICAgICAgIGlmIChjb3VudHJ5KSB7XG4gICAgICAgICAgICBlbC50aXRsZSA9IGNvdW50cnkuaW5uZXJUZXh0O1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBhZGRFdmVudEhhbmRsZXIoJy5hZ2VuY3ktZGVzY3JpcHRpb25fX3RpdGxlX19zZWUtbW9yZScsICdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMucGFyZW50RWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFnZW5jeS1kZXNjcmlwdGlvbl9fdGV4dCcpLmNsYXNzTGlzdC50b2dnbGUoJ2lzLWhpZGRlbicpO1xuICAgIH0pO1xuXG4gICAgYWRkRXZlbnRIYW5kbGVyKCcuYWdlbmN5LXNwZWNpYWxpc3RzX190aXRsZV9fc2VlLW1vcmUnLCAnY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hZ2VuY3ktc3BlY2lhbGlzdHNfX2xpc3QnKS5jbGFzc0xpc3QudG9nZ2xlKCdpcy1oaWRkZW4nKTtcbiAgICB9KTtcblxuICAgIGFkZEV2ZW50SGFuZGxlcignLnByb3BlcnR5LWxpc3RfX2l0ZW0tcGhvdG8tcmVtb3ZlLCAucHJvcGVydHktbGlzdF9faXRlbS1kZXRhaWxzLWJ1dHRvbnMtcmVtb3ZlLCAucHJvcGVydHktbGlzdF9faXRlbS1pbmZvLWJ1dHRvbnMtcmVtb3ZlJywgJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgbGV0IHByb3BlcnR5ID0gdGhpcy5jbG9zZXN0KCcucHJvcGVydHktbGlzdF9faXRlbScpO1xuICAgICAgICBpZiAocHJvcGVydHkpIHtcbiAgICAgICAgICAgIHByb3BlcnR5LmNsYXNzTGlzdC50b2dnbGUoJ2lzLWhpZGRlbicpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBhZGRFdmVudEhhbmRsZXIoJy5wcm9wZXJ0eS1saXN0X19pdGVtLXBob3RvLWxpa2UsIC5wcm9wZXJ0eS1saXN0X19pdGVtLWRldGFpbHMtYnV0dG9ucy1saWtlLCAucHJvcGVydHktbGlzdF9faXRlbS1pbmZvLWJ1dHRvbnMtbGlrZScsICdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGxldCBwcm9wZXJ0eSA9IHRoaXMuY2xvc2VzdCgnLnByb3BlcnR5LWxpc3RfX2l0ZW0nKTtcbiAgICAgICAgaWYgKHByb3BlcnR5KSB7XG4gICAgICAgICAgICBwcm9wZXJ0eS5jbGFzc0xpc3QudG9nZ2xlKCdpcy1saWtlZCcpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBTZWFyY2ggcGFnZVxuXG4gICAgYWRkRXZlbnRIYW5kbGVyKCcuc2VhcmNoLWZvcm1fX2ZsYXRzLWJ1dHRvbiwgLnNlYXJjaC1mb3JtX19iZWRyb29tcy1idXR0b24sIC5zZWFyY2gtZm9ybV9fY29zdC1idXR0b24nLCAnY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLmNsYXNzTGlzdC50b2dnbGUoJ2lzLWFjdGl2ZScpO1xuXG4gICAgICAgIGxldCBwYXJlbnQgPSB0aGlzLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgIHBhcmVudC5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcblxuICAgICAgICBsZXQgb3B0aW9ucyA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9ucycpO1xuICAgICAgICBpZiAob3B0aW9ucykge1xuICAgICAgICAgICAgb3B0aW9ucy5jbGFzc0xpc3QudG9nZ2xlKCdpcy1oaWRkZW4nKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgYWRkRXZlbnRIYW5kbGVyKCcuc2VhcmNoLWZvcm1fX2ZpbHRlcnMtYnV0dG9uJywgJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcbiAgICAgICAgbGV0IHBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlYXJjaC1mb3JtX19wb3B1cCcpO1xuICAgICAgICBpZiAocG9wdXApIHtcbiAgICAgICAgICAgIHBvcHVwLmNsYXNzTGlzdC50b2dnbGUoJ2lzLWhpZGRlbicpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBhZGRFdmVudEhhbmRsZXIoJy5zZWFyY2gtZm9ybV9fcG9wdXAtaW5wdXQtYnV0dG9uJywgJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcblxuICAgICAgICBsZXQgcGFyZW50ID0gdGhpcy5wYXJlbnRFbGVtZW50O1xuICAgICAgICBwYXJlbnQuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XG5cbiAgICAgICAgbGV0IG9wdGlvbnMgPSBwYXJlbnQucXVlcnlTZWxlY3RvcignLm9wdGlvbnMnKTtcbiAgICAgICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgICAgICAgIG9wdGlvbnMuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtaGlkZGVuJyk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGFkZEV2ZW50SGFuZGxlcignLnNlYXJjaC1mb3JtX19wb3B1cC10YWcnLCAnY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLmNsYXNzTGlzdC50b2dnbGUoJ2lzLXNlbGVjdGVkJyk7XG4gICAgfSk7XG5cbiAgICBhZGRFdmVudEhhbmRsZXIoJy5zZWFyY2gtZm9ybV9fcG9wdXAtdGl0bGUtc3dpdGNoJywgJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgbGV0IGdyb3VwID0gdGhpcy5jbG9zZXN0KCcuc2VhcmNoLWZvcm1fX3BvcHVwLWdyb3VwJyk7XG4gICAgICAgIGlmIChncm91cCkge1xuICAgICAgICAgICAgZ3JvdXAuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGFkZEV2ZW50SGFuZGxlcignLnNlYXJjaC1yZXN1bHRfX3RhZy1yZW1vdmUnLCAnY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBsZXQgdGFnID0gdGhpcy5jbG9zZXN0KCcuc2VhcmNoLXJlc3VsdF9fdGFnJyk7XG4gICAgICAgIGlmICh0YWcpIHtcbiAgICAgICAgICAgIHRhZy5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgYWRkRXZlbnRIYW5kbGVyKCcuc2VhcmNoLXJlc3VsdF9fY29udHJvbHMtaXRlbS1idXR0b24nLCAnY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLmNsYXNzTGlzdC50b2dnbGUoJ2lzLWFjdGl2ZScpO1xuICAgIH0pO1xuXG4gICAgLy8gQ29tbW9uIHBhZ2VcblxuICAgIGFkZEV2ZW50SGFuZGxlcignLmNvbnRlbnRfX2JvZHktLWNvbW1vbiAudGFic19faXRlbScsICdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgbGV0IHRhYnMgPSB0aGlzLmNsb3Nlc3QoJy50YWJzJyk7XG4gICAgICAgIGxldCB0YWJzX2l0ZW1zID0gdGFicy5xdWVyeVNlbGVjdG9yQWxsKCcudGFic19faXRlbScpO1xuXG4gICAgICAgIHRhYnNfaXRlbXMuZm9yRWFjaCgodGFiKSA9PiB7XG4gICAgICAgICAgICB0YWIuY2xhc3NMaXN0LnJlbW92ZSgnaXMtc2VsZWN0ZWQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKCdpcy1zZWxlY3RlZCcpO1xuICAgIH0pO1xuXG4gICAgYWRkRXZlbnRIYW5kbGVyKCcuY29udGVudF9fYm9keS0tY29tbW9uIC5mYXFfX2l0ZW0tbGluaycsICdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgbGV0IGZhcV9pdGVtID0gdGhpcy5jbG9zZXN0KCcuZmFxX19pdGVtJyk7XG5cbiAgICAgICAgaWYgKGZhcV9pdGVtKSB7XG4gICAgICAgICAgICBmYXFfaXRlbS5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgYWRkRXZlbnRIYW5kbGVyKCcub3B0aW9uc19faXRlbScsICdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBsZXQgb3B0aW9ucyA9IHRoaXMuY2xvc2VzdCgnLm9wdGlvbnMnKTtcblxuICAgICAgICBpZiAob3B0aW9ucykge1xuICAgICAgICAgICAgbGV0IG11bHRpcGxlID0gb3B0aW9ucy5jbGFzc0xpc3QuY29udGFpbnMoJ29wdGlvbnMtLW11bHRpcGxlJyk7XG5cbiAgICAgICAgICAgIGlmIChtdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgIGxldCBjaGVja2JveCA9IHRoaXMucXVlcnlTZWxlY3RvcignLmNieCcpO1xuICAgICAgICAgICAgICAgIGlmIChjaGVja2JveCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tib3guY2hlY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKCdpcy1zZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKCdpcy1zZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QudG9nZ2xlKCdpcy1zZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IG9wdGlvbnNfaXRlbXMgPSBvcHRpb25zLnF1ZXJ5U2VsZWN0b3JBbGwoJy5vcHRpb25zX19pdGVtJyk7XG4gICAgICAgICAgICAgICAgb3B0aW9uc19pdGVtcy5mb3JFYWNoKCh0YWIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2lzLXNlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBsZXQgb3B0aW9uc19jaGVja2JveGVzID0gb3B0aW9ucy5xdWVyeVNlbGVjdG9yQWxsKCcuY2J4Jyk7XG4gICAgICAgICAgICAgICAgb3B0aW9uc19jaGVja2JveGVzLmZvckVhY2goKGNieCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjYnguY2hlY2tlZCA9ICcnO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKCdpcy1zZWxlY3RlZCcpO1xuXG4gICAgICAgICAgICAgICAgbGV0IGNoZWNrYm94ID0gdGhpcy5xdWVyeVNlbGVjdG9yKCcuY2J4Jyk7XG4gICAgICAgICAgICAgICAgaWYgKGNoZWNrYm94KSBjaGVja2JveC5jaGVja2VkID0gJ2NoZWNrZWQnO1xuXG4gICAgICAgICAgICAgICAgbGV0IHBhcmVudCA9IG9wdGlvbnMucGFyZW50RWxlbWVudDtcbiAgICAgICAgICAgICAgICBwYXJlbnQuY2xhc3NMaXN0LnJlbW92ZSgnaXMtYWN0aXZlJyk7XG5cbiAgICAgICAgICAgICAgICBsZXQgYnV0dG9uID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvbicpO1xuICAgICAgICAgICAgICAgIGlmIChidXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWFjdGl2ZScpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG9wdGlvbnMuY2xhc3NMaXN0LmFkZCgnaXMtaGlkZGVuJyk7XG5cbiAgICAgICAgICAgICAgICAvLyBzZXQgdmFsdWVcbiAgICAgICAgICAgICAgICBsZXQgaW5wdXQgPSBwYXJlbnQucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT10ZXh0XScpO1xuICAgICAgICAgICAgICAgIGlmIChpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9IHRoaXMuaW5uZXJUZXh0LnRyaW0oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxufSkoKTtcbiJdfQ==
